{% metadata_file .yamato/project.metafile %}
---
# Legacy job that matches the name with branch protections as of 8/11
# Can be removed once branch protections are updated to the new name
pull_request_trigger_legacy:
  name: Pull Request Trigger on 2021.1 (main, develop, & release branches)
  dependencies:
    - .yamato/_triggers.yml#pull_request_trigger_upm
  triggers:
    cancel_old_ci: true
    pull_requests:
    - targets:
        only:
          - "main"
          - "develop"
          - "/release\/.*/"

# Run all relevant tasks when a pull request targeting the develop
# branch is created or updated. Currently only netcode package tests are
# enabled, since the others are missing test coverage and will fail CI.
pull_request_trigger:
  name: Pull Request Trigger (main, develop, & release branches)
  dependencies:
    - .yamato/project-standards.yml#standards_{{ projects.first.name }}
  triggers:
    cancel_old_ci: true
    pull_requests:
    - targets:
        only:
          - "main"
          - "develop"
          - "/release\/.*/"

# Run all relevant tasks when a pull request targeting the develop
# branch is created or updated. Currently only netcode package tests are
# enabled, since the others are missing test coverage and will fail CI.
pull_request_trigger_upm:
  name: Pull Request Trigger (main, develop, & release branches)
  dependencies:
{ % for project in projects -% }
{ % for platform in test_platforms -% }
    - .yamato/project-tests.yml#test_{{ project.name }}_{{ project.test_editors.first }}_{{ platform.name }}
{ % endfor -% }
{ % endfor -% }
  triggers:
    cancel_old_ci: true
    pull_requests:
    - targets:
        only:
          - "main"
          - "develop"
          - "/release\/.*/"
